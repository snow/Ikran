{% extends 'webapp/base.html' %}
{% block page_class %}pg-settings{% endblock %}

{% block layout_bd %}
{% include 'webapp/com/left/settings_nav.html' with cur='thirdparty' %}

<section class="sec-main">
    <h2>Thirdparty service settings</h2>
    
    <section>
        <h4>Douban</h4>
        {% if douban_account %}
        <span>connected with {{ douban_account.username }}</span>
        {% else %}
        <a href="/thirdparty/douban/authorize/">Connect with douban</a>
        {% endif %}
    </section>
    
    <section>
        <h4>Google</h4>
        {% if google_account %}
        <span>connected with {{ google_account.username }}</span>
        {% else %}
        <a href="/thirdparty/google/authorize/">Connect with google</a>
        {% endif %}
    </section>
    
    <section>
        <h4>Twitter</h4>
        {% if twitter_account %}
        <span>connected with {{ twitter_account.username }}</span>
        {% else %}
        <a href="/thirdparty/twitter/authorize/">Connect with twitter</a>
        {% endif %}
    </section>
    
    <section class="flickr">
        <h4>Flickr</h4>
        {% if flickr_account %}
        <span>connected with {{ flickr_account.username }}</span><br />
        <a id="import_flickr" href="/thirdparty/flickr/import/">import your flickr photos</a>
        {% else %}
        <a href="/thirdparty/flickr/authorize/">Connect with flickr</a>
        {% endif %}
    </section>
    
    <script>
(function($){
    var j_dialog = $('<div class="" title="Import your flickr photos">'+
                         '<p class="ing">Analyzing your stream</p>'+
                         '<p class="done" style="display:none">Your photos has been queued.<br />'+
                             'It may take quite a white to complete.</p>'+
                     '</div>').dialog({
                         modal: true,
                         autoOpen: false,
                         closeOnEscape: false,
                         buttons:{
                            OK: function(){
                                $(this).dialog('close');
                            }
                        }
                     }),
        j_active_link = $('#import_flickr').removeAttr('id'),
        j_dialog_ctn = j_dialog.closest('.ui-dialog'),
        j_OK = j_dialog_ctn.find('.ui-dialog-buttonpane button');    
    
    j_dialog_ctn.find('.ui-dialog-titlebar-close').remove();    
    j_OK.attr('disabled', 'disabled');
    
    j_active_link.click(function(evt){
        evt.preventDefault();
        
        j_dialog.dialog('open');
        
        $.ajax(j_active_link.attr('href'), {
            type: 'POST',
            success: function(){
                j_dialog.find('.ing').remove();
                j_dialog.find('.done').show();
            },
            complete: function(){
                j_OK.removeAttr('disabled');
            }
        });
    });
})(jQuery);        
    </script>
    
    <div class="c"></div>
</section>

<section class="sec-right">
    <section class="help">
        <h3>help</h3>
        <h4>viewing image <em>(aka. darkbox)</em></h4>            
        <ul>
        <li><strong>esc</strong>: exit darkbox</li>
        <li><strong>a</strong> / <strong>h</strong> / <strong>left</strong>: prev image</li>
        <li><strong>d</strong> / <strong>l</strong> / <strong>right</strong>: next image</li>
        <li><strong>click on blank</strong>: toggle header and footer</li>
        </ul>
    </section>
    
    {% include 'webapp/com/right/feedback.html' %}
</section>
{% endblock %}

{% block layout_extra %}
{% endblock %}
